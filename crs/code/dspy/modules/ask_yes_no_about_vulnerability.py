import dspy
import models as models
# from caching import cache_predictions
from typing import List
from modules.mixins import YesOrNoQuestionInput, VulnerabilityInput, CodeInput, YesOrNoAnswerOutput

class AskYesNoAboutVulnerabilitySignature(dspy.Signature, YesOrNoQuestionInput, VulnerabilityInput, YesOrNoAnswerOutput):
    """Answer the yes-or-no question about the provided cyber security vulnerability, using True for 'yes' or False for 'no'."""

class AskYesNoAboutVulnerability(dspy.Module):
    def __init__(self, verbose=False):
        self.verbose = verbose
        self.asker = dspy.Predict(AskYesNoAboutVulnerabilitySignature)

    def forward(self, question, vuln):
        askpred = self.asker(yes_or_no_question=question, vulnerability=vuln)
        return dspy.Prediction(answer=askpred.yes_or_no_answer)

def ask_yes_no_about_vulnerability(question, vuln):
    asker = AskYesNoAboutVulnerability()
    pred = asker(question, vuln)
    return pred.answer
