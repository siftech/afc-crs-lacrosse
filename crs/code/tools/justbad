#!/usr/bin/env perl
# omits the Good stuff from juliet examples
# after various complicated versions commented-out that didnt quite work, we're
# just relying on the endif having OMITGOOD in comment... and since it always does
# b/c generated by a template, it should be ok

$level=0;
$omitgoodlevel= -1;
while (<>) {

	#if (/^\#ifndef\s*OMITGOOD/) {print "got ifndef $_ omitgood when level is $level\n";}
	#if (/^\#if/) {print "got if $_ when level is $level\n";}
	#if (/^\#endif/) {print "got endif $_ when level is $level\n";}

#	if (/^\#ifndef\s*OMITGOOD/) {$dontprint=1; $omitgoodlevel=$level; $level++; next;}
#	if ($dontprint && /^\#endif/ && $level==$omitgoodlevel+1) {$dontprint=0; $level--; $omitgoodlevel= -1; $next;}
#	if (/^\#if/) {$level++; if (!$dontprint) { print;} next;}
#	if (/^\#endif/) {$level--; if (!$dontprint) { print;} next;}

	if (/^\#ifndef\s*OMITGOOD/) {$dontprint=1; next;}
	if (/^\#endif.*OMITGOOD/) {$dontprint=0; next;}

	#if ($dontprintndef && /^\#endif/) {$dontprintndef=0; next;}

#	if (/^\#ifndef\s*OMITBAD/) {$dontprintndef=1; next;}
#	if ($dontprintndef && /^\#endif/) {$dontprintndef=0; next;}

	if ($dontprint) {next;}
	print;
}
